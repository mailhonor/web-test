var zyEditorTB=[
['font','字体','R0lGODlhHAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAcABQAAAI8jI+py+0Po5ygVXMX2LyjnCUbAwYdp52h+UmrCb6aUl21rJ5HjbGODNv1LCSY51cU/kYz5eQJjUqnVGgBADs='],
['title','标题','R0lGODlhHAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAcABQAAAJGjI+py+0Po4RAVQOy3qtujYXBZYEM93XO5R2k630s2L5Y5q7jjrQ7fkv5cqwfsdfwFX+4YQLIqy15zyAyyJlot9yu9zspAAA7'],
['hr','横线','R0lGODlhFAAUAJEAAICAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIrlI+py+0N3opRgIvv1BJRk2HdSCrBiaapqbZn+VTlZ4VcIs4WaMP+D3wUAAA7'],
['bold','粗体','R0lGODlhFAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAUABQAAAIjjI+py+0PowS00lhNfnu7fnFWKAIa2YBmea7piEryTNf2jRQAOw=='],
['italic','斜体','R0lGODlhFAAUAJEAAICAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIglI+py+0Po0Sh1ikqwOBizXkTOHUBlgWbZFnoC8fyDBUAOw=='],
['underline','下划线','R0lGODlhFAAUAJEAAICAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIolI+py+0Poww0iGofPRv2m2nh53xkY4blqKIBIACnW0k2guX3zvd3AQA7'],
['strikethrough','删除线','R0lGODlhFAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAUABQAAAIqjI+py+0Po5wJGIDtxUsHbYFKdpXe+G3imLUuiXih2XHvAVP6zvf+vygAADs='],
['fontsize','大小','R0lGODlhHAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAcABQAAAI3jI+py+0Po5zgVXlbhnkfnwDiSG7VGYFfcKkh064aq3SIS3vmDcsL7jO4gKKfqThJKpfMprNZAAA7'],
['forecolor','颜色','R0lGODlhFAAUALMAAP//AAD//2ZmZgCCAP8A/wBmAP8AAAAA/wAAAP///wAAAAAAAAAAAAAAAAAAAAAAACH5BAUUAAkALAAAAAAUABQAAARQMMlJq73Yos17Tsi0iV8ojedHoWrFtmIozDSNjYKhC0Ev3DKdgecDJmpIi6AjADgFhUHh92k+pQNqBllTCQ5gAWGsxXzDY0L5wrXB3vD4JAIAOw=='],
['backcolor','背景','R0lGODlhFAAUALMAAP//////AMzMzAD//6eil2ZmZgCCAP8A/wBmAP8AAAAA/wAAAP///wAAAAAAAAAAACH5BAUUAAwALAAAAAAUABQAAARekMlJq704s7X0XQLnVVzYjRIILMTpqatQcK4Fh0Wu69SNJ8DCYFjoAQCC5KIATAiJpKRsRy1GC61CYFtAGBBW0oyh5X4NYZKkytMUFPDCYZ6+vOPzQ93CzqH+gIEUEQA7'],
['removeformat','删除格式','R0lGODlhFAAUAMMLAAICAsvT3l5wiqy0uTJKYvL09nKFopas0uLn8nKOsrLC2v79/tre5ISatYKSogAAACH5BAEAAA8ALAAAAAAUABQAAARV8MlJq7046803O0fSMN23nEESeMe5FEvQaOZZIMhiZPWLLw0BpnfLNRyEC/F3JAwuLRsT+YTiYLBm9dJQKAKIglYTMBhAg4azMxC4AfA4vEOv2++YCAA7'],
['insertorderedlist','项目编号','R0lGODlhFAAUAJEAAAAAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIllI+py+0N3gLRhIvxlIpWDjJUmFTZuZGCp7YGq35nJsafi+dSAQA7'],
['insertunorderedlist','项目符号','R0lGODlhFAAUAJEAAAAAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIklI+py+0M4lMRmIBzpnL6DxpVKIyChnIWybZiB5qoprr2jTMFADs='],
['outdent','左移','R0lGODlhFAAUAJEAAAAAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIrlI+py43hohShQovrnOBlmwDd8YGHiG6G6GHNaHzq5pba3NQQzsf9D3QUAAA7'],
['indent','右移','R0lGODlhFAAUAJEAAAAAgAAAAP///wAAACH5BAUUAAIALAAAAAAUABQAAAIrlI+py43hohShQovrnOBlqwCd8YGHiG7nSGUN22LqJpfa3NQQzpP9D3QUAAA7'],
['justifyleft','左对齐','R0lGODlhFAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAUABQAAAIejI+py+0PE5i01hitxTzoD3QOOIkZeZkLqrbuCxsFADs='],
['justifycenter','居中','R0lGODlhFAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAUABQAAAIdjI+py+0PE5i01oiDtTnuD3QQOIkPyZkNqrbuCxcAOw=='],
['justifyright','右对齐','R0lGODlhFAAUAIAAAAAAAP///yH5BAUUAAEALAAAAAAUABQAAAIdjI+py+0PE5i01oiPtfntD3QYOIkNyZkeqbbu6xYAOw=='],
['link','超级连接','R0lGODlhFAAUALMAAP///8DR6sDAwIiYqICAgACAgACCAAAA/wAAgAAAAP///wAAAAAAAAAAAAAAAAAAACH5BAUUAAoALAAAAAAUABQAAARtUMlJq704k80z3YUQBEbiKQQgAIPhlhpxqEd9uAQmC8OAuDfYRdZ6IQo/07BWfNWUFpntZSgcoBUCYupE5DAJW2KcQJCxlHJitUqoVOjJ+kwXxBXuBGEtsO8Bd3N0ZHZgbIBvhRlneGQnj5AYEQA7'],
['unlink','删除超级连接','R0lGODlhFAAUALMAAP///8DR6sDAwKWlpYiYqI2aN4CAgElj0gCAgACCAAAA/wAAgAAAAP///wAAAAAAACH5BAUUAA0ALAAAAAAUABQAAARwsMlJq704m80z3YgQBAnjNQYgAETilpqhqEqtuAYmCwSxuDfYRdZ6LRA/07BWfNWUFpntlUAooBXDYupc5DCMcHhQOBzE2AkjlWKYGQB2eo0eoMUGLFwfB5j2FHRidnd0FWt9SnByF3UShGEnkpMYEQA7'],
['image','图片','R0lGODlhFAAUAKIAAP//////AMDAwICAgICAAAAAAP///wAAACH5BAUUAAYALAAAAAAUABQAAANXaLrc/jDKV6q9uJUAuO9gUGhhOFQDMDJbyRUEsa1L4XawrGrfdxYDEal3oylaL2TIaLC9BieRc8d6nk4CgZNpA0K/hWxX4y1Dw1ru98pGczFwy2ROr9MTADs='],
['table','表格','R0lGODlhFAAUAKIAAP///8zMzAAAZQAAAP///wAAAAAAAAAAACH5BAUUAAQALAAAAAAUABQAAANISLrc/jDKN6q9eLAhuv+ftnBg2YnKAADByrotixLqu8Z2MA9B7/+/3Q1GlG2GyNwOyPQJbdCY7hgtTkfN5i7DrUy+4LB4TEgAADs='],
['time','时间','R0lGODlhFAAUANQVADI6Upey19Li/mFuhYas8oGNnm6S0qystK7J/vL2+rLC2lthalJ6spedp4edzTJScsvN08La/nR8jru9wuLt+f79/kBJWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABcALAAAAAAUABQAAAVs4CWOZGmeaKqubOte0NQURTOxMZVUCSQdqthuwksoBjfUZFdp6CgChyTVqFglEAolErCkCtbE4iCIIAiA79NiGTgQBi+qoRDYzWfGFOULIP5nBg9JKAcDBgQEBgwPDSwTBQsAFguEL5eYmZkhADs='],
['about','关于帮助','R0lGODlhFAAUAKIAAP//////AMDR6oCAgAAAgAAAAP///wAAACH5BAUUAAYALAAAAAAUABQAAANSaLrc/hCWSet8BeigAd+Fk31e94VNpglESwigWLYBS5yyRgw6EaelzWCHA24AQ9iPMersjgAU00RdLpo9qPRK5ZAC26tFRYmIwGZJOH1lu9+PBAA7']
];
function zyEditor(){
this.is_ie=(document.all)?1:0;
this.is_ff=!this.is_ie;
this.popMenus={};
this.buttons={};
this.CE=function(L,h){
	var d=document.createElement("DIV");
	d.innerHTML=h;
	return d.getElementsByTagName(L)[0];
}
this.AP=function(a,b){
	a.appendChild(b);
}
this.getContent = function(){
	return this.doc.body.innerHTML;
}
this.setContent = function(str){
	if(str==null||str=="")str="<br>";
	this.command("selectall");
	this.command("inserthtml", str);
	this.content=this.getContent();
}
this.isChanged = function(){
	return this.getContent()==this.content?0:1;
}
this.showEditor = function(SO){
	var tb,tb2,tr,td,i,im,im2,cm,wid,doc,tob=zyEditorTB;
	tb=this.CE("table",'<table style="height:100%;width:100%"><tr><td></td></tr><tr><td style="height:100%;width:100%"></td></tr></table>');
	this.AP(SO,tb);
	tb2=this.CE("table",'<table cellpadding="0" cellspacing="0" border="0"><tr></tr></table>');
	this.AP(tb.rows[0].cells[0],tb2);
	tr=tb2.rows[0];
	for(i=0;i<tob.length;i++){
		td=tr.insertCell(tr.cells.length);td.width="10";td.vAlign="top";td.noWrap="noWrap";
		im=this.CE("div",'<div style="position:relative;height:22px;margin-right:2px;" title="'+tob[i][1]+'"></div>');
		this.buttons[tob[i][0]]=im;
		im2=this.CE("div",'<div style="cursor:pointer;border:1px solid #EEF5FB;"><img src="data:image/jpeg;base64,'+tob[i][2]+'" border="0"></div>');
		this.AP(im,im2);
		im2.editor=this;
		im2.command=tob[i][0];
		im2.onclick=function(){this.editor.command(this.command);}
		im2.onmouseover=function(){this.style.border='1px solid #AAAAAA';}
		im2.onmouseout=function(){this.style.borderColor="#EEF5FB";}
		this.AP(td,im);
	}
	wid=this.CE("iframe",'<iframe style="height:100%;width:100%;border:1px solid #C3D9FF"></iframe>');
	this.AP(tb.rows[1].cells[0],wid);
	this.win=wid.contentWindow;
	this.doc=wid.contentWindow.document;
	this.doc.editor=this;
	this.doc.write('<html><head>');
	this.doc.write('</head>');
	this.doc.write('<body style="background-color:#FFFFFF">');
	this.doc.write("help");
	this.doc.write('</body></html>');
	this.doc.close();
	this.doc.designMode="On";
	if(this.is_ie){
		this.doc.onclick=function(){this.editor.generalClick();}
		this.doc.onbeforedeactivate=this.ie_onbeforedeactivate;
		this.doc.onactivate=this.ie_onactivate;
	}else{
		this.doc.addEventListener("click",function(){this.editor.generalClick();},false);
	}
}
this.colorList="FFFFFF FF0000 00FF00 0000FF FF00FF 00FFFF FFFF00 000000 F0F8FF 70DB93 5C3317 9F5F9F B5A642 D9D919 A62AA2 8C7853 A67D3D 5F9F9F D98719 B87333 FF7F00 42426F 5C4033 2F4F2F 4A766E 4F4F2F 9932CD 871F78 6B238E 2F4F4F 97694F 7093DB 855E42 545454 856363 D19275 8E2323 238E23 CD7F32 DBDB70 527F76 93DB70 215E21 4E2F2F 9F9F5F C0D9D9 A8A8A8 8F8FBD E9C2A6 32CD32 E47833 8E236B 32CD99 3232CD 6B8E23 EAEAAE 9370DB 426F42 7F00FF 7FFF00 70DBDB DB7093 A68064 2F2F4F 23238E 4D4DFF FF6EC7 00009C EBC79E CFB53B FF7F00 FF2400 DB70DB 8FBC8F BC8F8F EAADEA D9D9F3 5959AB 6F4242 8C1717 238E68";
this.getColorTable=function(cmd){
	var str='<table><tr>',i,j,cs;
	cs=this.colorList.split(" ");
	for(i=0;i<81;i++){
		if(i==0) str+='<tr>';
		else if(i%9==0)
			str+='</tr><tr>';
		str+='<td><div style="width:12px;height:12px;border:1px solid #AAAAAA;font-size:1px;cursor:pointer;background-color:#'+cs[i]+'"></div></td>';
	}
	str+='</tr></table>';
	var tb=this.CE("table",str),tds;
	tds=tb.getElementsByTagName("td");
	for(i=0;i<81;i++){
		tds[i].editor=this;
		eval('tds[i].onclick=function(){this.editor.command("'+cmd+'","'+cs[i]+'")}');
	}
	return tb;
}
this.getTitleTable=function(){
	var str='',d1,d2;
	d1=this.CE("div",'<div><div>');
	for(i=1;i<6;i++){
		d2=this.CE("div",'<div style="cursor:pointer;"><b>标题 '+ i+'</b></div>');
		d2.editor=this;
		eval('d2.onclick=function(){this.editor.command("formatblock:true","<H'+i+'>")}');
		this.AP(d1,d2);
	}
	return d1;
}
this.getSizeTable=function(){
	var fs =[8,10,12,14,18,24,36],d1,d2,i;
	d1=this.CE("div",'<div></div>');
	for(i=fs.length-1;i>-1;i--){
		d2=this.CE("div",'<div>'+fs[i]+'px</div>');
		d2.editor=this;
		eval('d2.onclick=function(){this.editor.command("fontsize:true",'+(i+1)+');}');
		this.AP(d1,d2);
	}
	return d1;
}
this.getForeColorTable=function(){
	if(this.getForeColorTableSelf) return this.getForeColorTableSelf();
	return this.getColorTable('forecolor:true');
}
this.getBackColorTable=function(){
	if(this.getBackColorTableSelf)return this.getBackColorTableSelf();
	return this.getColorTable('backcolor:true');
}
this.getLinkTable=function(){
	var str='',d1,d2;
	if(this.getLinkTableSelf) return this.getLinkTableSelf();
	d1=this.CE("div",'<div><div>');
	d2=this.CE("input",'<input type="text" value="" size="25">');
	this.___linkInput=d2; this.AP(d1,d2);
	d2=this.CE("input",'<input type="button" value="确定">');
	this.___linkOk=d2;d2.editor=this; this.AP(d1,d2);
	d2.onclick=function(){var as={};as.href=this.editor.___linkInput.value;this.editor.commandCreateLink(as);}
	return d1;
}
this.getImgTable=function(){
	var str='',d1,d2;
	if(this.getImgTableSelf) return this.getImgTableSelf();
	d1=this.CE("div",'<div><div>');
	d2=this.CE("input",'<input type="text" value="" size="25">');
	this.___imgInput=d2; this.AP(d1,d2);
	d2=this.CE("input",'<input type="button" value="确定">');
	this.___imgOk=d2;d2.editor=this; this.AP(d1,d2);
	d2.onclick=function(){var as={};as.src=this.editor.___imgInput.value;this.editor.commandCreateImg(as);}
	return d1;
}
this.getTableTable=function(){
	var str='',d1,d2,tr;
	d1=this.CE("div",'<div><table><tr><td>行数<br></td><td>列数<br></td><td></td></table><div>');
	tr=d1.getElementsByTagName("table")[0].rows[0];
	d2=this.CE("input",'<input type="text" value="3" size="3">');
	this.___tableRows=d2; this.AP(tr.cells[0],d2);
	d2=this.CE("input",'<input type="text" value="3" size="3">');
	this.___tableCols=d2; this.AP(tr.cells[1],d2);
	d2=this.CE("input",'<input type="button" value="确定">');
	this.___tableOk=d2;d2.editor=this; this.AP(tr.cells[2],d2);
	d2.onclick=function(){
		var as={};
		as.rows=this.editor.___tableRows.value;
		as.cols=this.editor.___tableCols.value;
		this.editor.commandCreateTable(as);
	}
	return d1;
}
this.getSelection = function(){
	if (this.is_ie){
		this.selection = this.doc.selection;
		this.selectionRange = this.selection.createRange();
	} else {
		this.selection = this.win.getSelection();
		this.selectionRange = this.selection.getRangeAt(0);
	}
}
this.ie_onbeforedeactivate=function(){
	var range = this.doc.selection.createRange();
	this.bookmark=range.getBookmark();
}
this.ie_onactivate=function(){
	if(this.bookmark==null)return;
	var range = this.doc.body.createTextRange();
	range.moveToBookmark(this.bookmark);
	range.select();
	this.bookmark = null;
}
this.focus = function(){
	this.win.focus();
}
this.hidePopMenus=function(){
	var i;
	for(i in this.popMenus){
		this.popMenus[i].style.display="none";
	}
}
this.generalClick=function(){
	this.hidePopMenus();
}
this.dealSpecialObj=function(event){
	event = event || window.event;
	return(event.srcElement||event.target);
}
this.command=function(cmd,value){
	var tbfunc='';
	this.focus();
	this.getSelection();
	switch(cmd){
	case "justifyleft" :
	case "justifycenter" :
	case "justifyright" :
	case "insertorderedlist" :
	case "insertunorderedlist" :
	case "bold" :
	case "italic" :
	case "underline" :
	case "strikethrough" :
	case "unlink" :
	case "selectall" :
	case "removeformat" :
	case "indent" :
	case "outdent" :
	case "inserthtml" :
	case "formatblock:true" :
	case "title:true" :
	case "fontsize:true" :
	case "image:true":
	case "forecolor:true" :
	case "backcolor:true" :
	case "createlink:true" :
		this.hidePopMenus();
		cmd=cmd.split(":")[0];
		if(cmd=="backcolor") cmd="hilitecolor";
		if(this.is_ie){ 
			if(cmd=="inserthtml"){
				this.selectionRange.select();
				if (this.selection.type.toLowerCase() == 'control') {
					this.selectionRange.item(0).outerHTML = value;
				} else {
					this.selectionRange.pasteHTML(value);
				}
			}else if(cmd=="selectall"){
				this.selectionRange.moveToElementText(this.doc.body);
				this.selectionRange.execCommand(cmd,false,value);
				this.selectionRange.select();
			}else{
				this.selectionRange.execCommand(cmd,false,value);
				this.selectionRange.select();
			}
		}else{
			if(value==null)value=1;
			this.doc.execCommand(cmd,false,value);
		}
		return;
	case "time":
		function _g2(s){s=s+'';if(s.length==1)s='0'+s;return s;}
		var T=new Date();
		value=T.getFullYear()+"."+_g2(T.getMonth()+1)+"."+_g2(T.getDate())+"&nbsp;"+_g2(T.getHours())+":"+_g2(T.getMinutes());
	case "cmd_inserthtml":
		return this.command("inserthtml",value);
		break;
	case "title" :
		tbfunc="getTitleTable";
		break;
	case "fontsize" :
		tbfunc="getSizeTable";
		break;
	case "image":
		tbfunc="getImgTable";
		break;
	case "forecolor" :
		tbfunc="getForeColorTable";
		break;
	case "backcolor" :
		tbfunc="getBackColorTable";
		break;
	case "link" :
		tbfunc="getLinkTable";
		break;
	case "table" :
		tbfunc="getTableTable";
		break;
	default:
		break;
	}
	if(tbfunc!=''){
		var div,ro;
		if(this.popMenus[cmd]==null){
			div=this.CE("div",'<div style="position:absolute;border:1px solid #C3D9FF;background-color:#FFFFFF;padding:5px;"></div>');
			this.popMenus[cmd]=div;
			this.AP(this.buttons[cmd],div);
		}
		this.hidePopMenus();
		div=this.popMenus[cmd];
		div.style.display="block";
	       	eval("ro=this."+tbfunc+"();");
		div.innerHTML='';
		this.AP(div,ro);
	}
}
this.commandCreateLink=function(as){
	this.command("createlink:true",as.href)
}
this.commandCreateImg=function(as){
	this.command("image:true",as.src)
}
this.commandCreateTable=function(as){
	var tbs='',i,j,k,e,tds,trs;
	try{
		eval("i="+as.rows+";");
		eval("j="+as.cols+";");
	}catch(e){
		i=2;
		j=2;
	}
	tds='';
	for(k=0;k<j;k++){
		tds+='<td>&nbsp;</td>';
	}
	trs='';
	for(k=0;k<i;k++){
		trs+='<tr>'+tds+'</tr>';
	}
	tbs='<table border="1">'+trs+'<table><br>';
	this.command("inserthtml",tbs)
}
}
